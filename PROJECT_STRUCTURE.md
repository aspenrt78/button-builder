# Project Structure

```
ha-custom-button-architect/
â”œâ”€â”€ ğŸ“ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ validate.yaml          # HACS validation workflow
â”‚
â”œâ”€â”€ ğŸ“ custom_components/
â”‚   â””â”€â”€ button_card_architect/     # Home Assistant integration
â”‚       â”œâ”€â”€ __init__.py            # Integration setup and panel registration
â”‚       â”œâ”€â”€ manifest.json          # Integration metadata
â”‚       â””â”€â”€ ğŸ“ www/                # Built frontend assets (generated)
â”‚           â”œâ”€â”€ panel.html         # Panel wrapper HTML
â”‚           â”œâ”€â”€ index.js           # Compiled React app
â”‚           â””â”€â”€ index.css          # Compiled styles
â”‚
â”œâ”€â”€ ğŸ“ components/                 # React components
â”‚   â”œâ”€â”€ ConfigPanel.tsx            # Left sidebar configuration panel
â”‚   â”œâ”€â”€ ControlInput.tsx           # Reusable input components
â”‚   â”œâ”€â”€ MagicBuilder.tsx           # AI prompt modal
â”‚   â”œâ”€â”€ PreviewCard.tsx            # Live button preview
â”‚   â””â”€â”€ YamlViewer.tsx             # YAML output viewer
â”‚
â”œâ”€â”€ ğŸ“ services/
â”‚   â””â”€â”€ geminiService.ts           # Gemini AI integration
â”‚
â”œâ”€â”€ ğŸ“ utils/
â”‚   â””â”€â”€ yamlGenerator.ts           # YAML generation logic
â”‚
â”œâ”€â”€ ğŸ“„ App.tsx                     # Main React app component
â”œâ”€â”€ ğŸ“„ index.tsx                   # React entry point
â”œâ”€â”€ ğŸ“„ index.html                  # HTML template for dev
â”œâ”€â”€ ğŸ“„ index.css                   # Global styles and animations
â”‚
â”œâ”€â”€ ğŸ“„ types.ts                    # TypeScript interfaces
â”œâ”€â”€ ğŸ“„ constants.ts                # UI constants and options
â”‚
â”œâ”€â”€ ğŸ“„ vite.config.ts              # Vite build configuration
â”œâ”€â”€ ğŸ“„ tsconfig.json               # TypeScript configuration
â”œâ”€â”€ ğŸ“„ package.json                # NPM dependencies and scripts
â”‚
â”œâ”€â”€ ğŸ“„ hacs.json                   # HACS integration metadata
â”œâ”€â”€ ğŸ“„ README.md                   # Main documentation
â”œâ”€â”€ ğŸ“„ INSTALLATION.md             # Installation guide
â”œâ”€â”€ ğŸ“„ QUICKSTART.md               # Quick start guide
â”œâ”€â”€ ğŸ“„ CHANGELOG.md                # Version history
â”œâ”€â”€ ğŸ“„ CONTRIBUTING.md             # Contribution guidelines
â”œâ”€â”€ ğŸ“„ LICENSE                     # MIT License
â”‚
â”œâ”€â”€ ğŸ“„ build.ps1                   # Build script for Windows
â”œâ”€â”€ ğŸ“„ .env.local.template         # Environment variable template
â””â”€â”€ ğŸ“„ .gitignore                  # Git ignore rules
```

## Key Directories

### `/custom_components/button_card_architect/`
This is the Home Assistant integration. When installed, this entire folder goes into your HA `custom_components` directory.

- **`__init__.py`**: Registers the panel in Home Assistant's sidebar
- **`manifest.json`**: Defines integration metadata (name, version, dependencies)
- **`www/`**: Contains the built frontend (generated by `npm run build`)

### `/components/`
React components that make up the UI:

- **ConfigPanel**: The left sidebar with all the configuration options
- **PreviewCard**: The center preview showing how the button looks
- **YamlViewer**: The right panel displaying generated YAML
- **MagicBuilder**: The AI prompt modal overlay
- **ControlInput**: Reusable input components (text, color, select, etc.)

### `/services/`
Backend service integrations:

- **geminiService**: Handles communication with Google Gemini API for AI features

### `/utils/`
Utility functions:

- **yamlGenerator**: Converts ButtonConfig to button-card YAML format

## Build Process

### Development
```bash
npm run dev
```
- Starts Vite dev server on port 3000
- Hot reload enabled
- Uses `.env.local` for API keys

### Production
```bash
npm run build
```
- Compiles React app with Vite
- Outputs to `custom_components/button_card_architect/www/`
- Bundles as `index.js` and `index.css`
- Ready for Home Assistant integration

## Data Flow

```
User Input (ConfigPanel)
    â†“
ButtonConfig State (App.tsx)
    â†“
Live Preview (PreviewCard) + YAML Output (YamlViewer)
```

### AI Flow
```
User Prompt (MagicBuilder)
    â†“
Gemini API (geminiService)
    â†“
ButtonConfig (partial)
    â†“
Merged into App State
    â†“
Preview + YAML Update
```

## Configuration Object

The core `ButtonConfig` interface (in `types.ts`) defines all button properties:
- Core: entity, name, icon, label
- Layout: size, aspect ratio, padding
- Colors: background, text, element-specific colors
- Effects: blur, shadows, borders
- Animations: card and icon animations
- Actions: tap, hold, double-tap

This single object drives both the preview and YAML generation.

## Home Assistant Integration

When HA loads the integration:
1. `__init__.py` registers a static path `/button_card_architect/`
2. Registers an iframe panel in the sidebar
3. Panel loads `panel.html`
4. `panel.html` loads `index.js` (the compiled React app)
5. User designs buttons and copies YAML to dashboard

## File Naming Conventions

- **`.tsx`**: React components (TypeScript + JSX)
- **`.ts`**: TypeScript utilities and services
- **`.py`**: Python Home Assistant integration
- **`.json`**: Configuration and manifest files
- **`.md`**: Documentation in Markdown
- **`.yaml`**: GitHub workflows

## Adding New Features

### New Configuration Option
1. Add to `ButtonConfig` interface in `types.ts`
2. Add to `DEFAULT_CONFIG` constant
3. Add control in `ConfigPanel.tsx`
4. Update preview logic in `PreviewCard.tsx`
5. Update YAML generation in `yamlGenerator.ts`

### New Component
1. Create `.tsx` file in `/components/`
2. Import and use in `App.tsx`
3. Update types if needed

### New AI Feature
1. Update schema in `geminiService.ts`
2. Update prompt engineering
3. Test with various inputs

## Testing

### Local Development
- Run `npm run dev`
- Test all features in browser
- Check console for errors

### Home Assistant Testing
1. Build: `npm run build`
2. Copy `custom_components/button_card_architect` to HA config
3. Restart HA
4. Test in HA panel
5. Check HA logs for errors

## Release Checklist

- [ ] Update version in `package.json`
- [ ] Update version in `manifest.json`
- [ ] Update `CHANGELOG.md`
- [ ] Run `npm run build`
- [ ] Test in Home Assistant
- [ ] Commit all changes
- [ ] Create git tag: `git tag v1.0.0`
- [ ] Push with tags: `git push --tags`
- [ ] Create GitHub release with compiled `custom_components` folder
